<!--
 * @Author: 小叶同学
 * @Date: 2024-03-21 08:11:42
 * @LastEditors: Please set LastEditors
 * @LastEditTime: 2024-03-21 08:11:53
 * @Description: 请填写简介
-->

>[笔记引用:](https://blog.csdn.net/zhuguanlin121/article/details/118489092)
> 这几篇博文讲的不错，可参照着理解：  
> [STM32下拉输入模式与振动传感器的使用](https://blog.csdn.net/weixin_37704787/article/details/125431672)
> 
> [“上拉电阻与下拉电阻”通俗解读](https://blog.csdn.net/Reborn_Lee/article/details/88728014?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522166678732016782428672408%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=166678732016782428672408&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-88728014-null-null.142%5Ev62%5Epc_search_tree,201%5Ev3%5Econtrol_1,213%5Ev1%5Et3_control1&utm_term=%E4%B8%8A%E6%8B%89%E7%94%B5%E9%98%BB%E5%92%8C%E4%B8%8B%E6%8B%89%E7%94%B5%E9%98%BB&spm=1018.2226.3001.4187)
> 
> [上、下拉电阻（定义、强弱上拉、常见作用、吸电流、拉电流、灌电流）](https://blog.csdn.net/m0_52162042/article/details/121278274?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4-121278274-blog-47837963.pc_relevant_3mothn_strategy_recovery&spm=1001.2101.3001.4242.3&utm_relevant_index=7)

个人总结：

+   **模拟量**选浮空输入，模拟量是连续变化的值
+   **数字量**就两种状态0和1，选上拉和下拉，通过“拉高拉低”增益效果，消除中间态“”模糊电压“，同时赋予电路确定的初始值高或低。

#### 目录

- [STM32引脚说明](#stm32引脚说明)
- [GPIO种类](#gpio种类)
- [GPIO基本结构](#gpio基本结构)
- [GPIO输入输出的8种模式](#gpio输入输出的8种模式)
    - [上拉输入模式](#上拉输入模式)
    - [下拉输入模式](#下拉输入模式)
    - [浮空输入模式](#浮空输入模式)
    - [模拟输入模式](#模拟输入模式)
    - [开漏输出模式](#开漏输出模式)
    - [开漏复用输出模式](#开漏复用输出模式)
    - [推挽输出模式](#推挽输出模式)
    - [推挽复用输出模式](#推挽复用输出模式)
- [模式用途](#模式用途)
  - [1、 GPIO\_Mode\_AIN ：模拟输入](#1-gpio_mode_ain-模拟输入)
  - [2、GPIO\_Mode\_IN\_FLOATING ：浮空输入](#2gpio_mode_in_floating-浮空输入)
  - [3、GPIO\_Mode\_IPD：下拉输入](#3gpio_mode_ipd下拉输入)
  - [4、GPIO\_Mode\_IPU：上拉输入](#4gpio_mode_ipu上拉输入)
  - [5、GPIO\_Mode\_Out\_OD：开漏输出](#5gpio_mode_out_od开漏输出)
  - [6、GPIO\_Mode\_Out\_PP：推挽输出](#6gpio_mode_out_pp推挽输出)
  - [7、GPIO\_Mode\_AF\_OD：复用开漏输出](#7gpio_mode_af_od复用开漏输出)
  - [8、GPIO\_Mode\_AF\_PP：复用推挽输出](#8gpio_mode_af_pp复用推挽输出)
- [总结与分析](#总结与分析)
    - [1、什么是推挽结构和推挽电路](#1什么是推挽结构和推挽电路)
    - [2、开漏输出和推挽输出的区别](#2开漏输出和推挽输出的区别)
    - [3、STM32如何选择I/O模式](#3stm32如何选择io模式)

STM32F1xx官方资料：  
《STM32中文参考手册V10》-第8章通用和复用功能IO(GPIO和AFIO )  
芯片数据手册（datasheet)

## STM32引脚说明

GPIO是通用输入/输出端口的简称，是STM32可控制的引脚。GPIO的引脚与外部硬件设备连接，可实现与外部通讯、控制外部硬件或者采集外部硬件数据的功能。

STM32的大部分引脚除了当GPIO使用之外，还可以复用位外设功能引脚（比如串口），这部分在[【STM32】STM32端口复用和重映射（AFIO辅助功能时钟）](https://blog.csdn.net/qq_38410730/article/details/79828852) 中有详细的介绍。

## GPIO种类

本博板子STM32F103ZET6共有7组IO口，每组16个，共16×7=112个，分别为：  
GPIOA——>PA0、PA1、PA2…PA15  
GPIOB——>PB0、PB1、PB2…PB15  
.  
.  
.  
GPIOG——>PG0、PG1、PG2、…PG15

## GPIO基本结构

每个GPIO内部都有这样的一个电路结构，这个结构在本文下面会具体介绍。

![](https://img-blog.csdn.net/20180408224319518)

这边的电路图稍微提一下：

+   **保护二极管：IO引脚上下两边两个二极管用于防止引脚外部过高、过低的电压输入。**当引脚电压高于VDD时，上方的二极管导通；当引脚电压低于VSS时，下方的二极管导通，防止不正常电压引入芯片导致芯片烧毁。但是尽管如此，还是不能直接外接大功率器件，须加大功率及隔离电路驱动，防止烧坏芯片或者外接器件无法正常工作。
+   **P-MOS管和N-MOS管：由P-MOS管和N-MOS管组成的单元电路使得GPIO具有“推挽输出”和“开漏输出”的模式**。这里的电路会在下面很详细地分析到。
+   **TTL肖特基触发器：信号经过触发器后，模拟信号转化为0和1的数字信号。但是，当GPIO引脚作为ADC采集电压的输入通道时，用其“模拟输入”功能，此时信号不再经过触发器进行TTL电平转换。**ADC外设要采集到的原始的模拟信号。

这里需要注意的是，在查看《STM32中文参考手册V10》中的GPIO的表格时，会看到**有“FT”一列，这代表着这个GPIO口时兼容3.3V和5V的；如果没有标注“FT”，就代表着不兼容5V**。

## GPIO输入输出的8种模式

GPIO支持4种输入模式（浮空输入、上拉输入、下拉输入、模拟输入）和4种输出模式（开漏输出、开漏复用输出、推挽输出、推挽复用输出）。同时，GPIO还支持三种最大[翻转速度](https://blog.csdn.net/Kk_01110001B/article/details/81272172?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163109849216780261912918%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=163109849216780261912918&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v29_ecpm-5-81272172.pc_search_result_cache&utm_term=GPIO%E7%BF%BB%E8%BD%AC%E9%80%9F%E5%BA%A6&spm=1018.2226.3001.4187)（2MHz、10MHz、50MHz）。

每个I/O口可以自由编程，但I/O口寄存器必须按32位字被访问。

| 程序中标识               | 模式         |
| ------------------------ | ------------ |
| GPIO\_Mode\_AIN          | 模拟输入     |
| GPIO\_Mode\_IN\_FLOATING | 浮空输入     |
| GPIO\_Mode\_IPD          | 下拉输入     |
| GPIO\_Mode\_IPU          | 上拉输入     |
| GPIO\_Mode\_Out\_OD      | 开漏输出     |
| GPIO\_Mode\_Out\_PP      | 推挽输出     |
| GPIO\_Mode\_AF\_OD       | 复用开漏输出 |
| GPIO\_Mode\_AF\_PP       | 复用推挽输出 |

**下面将具体介绍GPIO的这八种工作方式：**

#### 上拉输入模式

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210705144108113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWd1YW5saW4xMjE=,size_16,color_FFFFFF,t_70)

![](https://img-blog.csdn.net/20180408225353767)

默认情况下输入引脚数据为1，高电平。

上拉输入模式下，I/O端口的电平信号直接进入输入数据寄存器。但是在I/O端口悬空（在无信号输入）的情况下，输入端的电平保持在高电平（自己理解：上拉电阻连接电压）；并且在I/O端口输入为低电平的时候，输入端的电平也是低电平（自己理解：上拉电阻上的电压和端口导通）。

> 施密特触发器：施密特就是为了防止在某一个临界电平的情况出现各种情况的抖动出现，为了稳定我们的输出而设计的。  
> 施密特触发器采用电位触发方式，其状态由输入信号电位维持；对于负向递减和正向递增两种不同变化方向的输入信号，施密特触发器有不同的阈值电压。

#### 下拉输入模式

![](https://img-blog.csdn.net/20180408225847140)

默认情况下输入引脚为0，低电平。

下拉输入模式下，I/O端口的电平信号直接进入输入数据寄存器。但是在I/O端口悬空（在无信号输入）的情况下，输入端的电平保持在低电平；并且在I/O端口输入为高电平的时候，输入端的电平也是高电平。

#### 浮空输入模式

![](https://img-blog.csdn.net/2018040822505125)

浮空输入模式下，I/O端口的电平信号直接进入输入数据寄存器。也就是说，I/O的电平状态是不确定的，完全由外部输入决定；如果在该引脚悬空（在无信号输入）的情况下，读取该端口的电平是不确定的。

通常用于IIC、USART。

#### 模拟输入模式

![](https://img-blog.csdn.net/20180409125151818)

模拟输入模式下，I/O端口的模拟信号（电压信号，而非电平信号）直接模拟输入到**片上外设模块**，比如ADC模块等。模拟信号一般：3.3v 5v 9v。

#### 开漏输出模式

![](https://img-blog.csdn.net/2018040912560259)

![在这里插入图片描述](https://img-blog.csdnimg.cn/05b8502fe0104214a169f447c6452e07.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6KGM56iz5pa56IO96LWw6L-c,size_20,color_FFFFFF,t_70,g_se,x_16)  
可以输出0和1，适用于电平不匹配场合，要得到高电平需要上拉电阻才行。

开漏输出模式下（上拉电阻+N-MOS管），通过设置位设置/清除寄存器或者输出数据寄存器的值，途经N-MOS管，最终输出到I/O端口。这里要**注意N-MOS管，当设置输出的值为高电平的时候，N-MOS管处于关闭状态，此时I/O端口的电平就不会由输出的高低电平决定，而是由I/O端口外部的上拉或者下拉决定；当设置输出的值为低电平的时候，N-MOS管处于开启状态，此时I/O端口的电平就是低电平。**同时，I/O端口的电平也可以通过输入电路进行读取；注意，I/O端口的电平不一定是输出的电平。

#### 开漏复用输出模式

![](https://img-blog.csdn.net/201804091309492)

开漏复用输出模式，与开漏输出模式很是类似。只是输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。

片内外设功能：TX1，MOSI，MISO，SCK，SS

#### 推挽输出模式

![](https://img-blog.csdn.net/20180409131225598)

![在这里插入图片描述](https://img-blog.csdnimg.cn/72249128a3444647b6e556679daa1959.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA6KGM56iz5pa56IO96LWw6L-c,size_20,color_FFFFFF,t_70,g_se,x_16)

可以输出高低电平0和1，适用于双向IO使用。

推挽输出模式下（P-MOS管+N-MOS管），通过设置位设置/清除寄存器或者输出数据寄存器的值，途经P-MOS管和N-MOS管，最终输出到I/O端口。这里要**注意P-MOS管和N-MOS管，当设置输出的值为高电平的时候，P-MOS管处于开启状态，N-MOS管处于关闭状态，此时I/O端口的电平就由P-MOS管决定：高电平；当设置输出的值为低电平的时候，P-MOS管处于关闭状态，N-MOS管处于开启状态，此时I/O端口的电平就由N-MOS管决定：低电平。**同时，I/O端口的电平也可以通过输入电路进行读取；注意，此时I/O端口的电平一定是输出的电平。

#### 推挽复用输出模式

![](https://img-blog.csdn.net/20180409131625100)

推挽复用输出模式，与推挽输出模式很是类似。只是输出的高低电平的来源，不是让CPU直接写输出数据寄存器，取而代之利用片上外设模块的复用功能输出来决定的。

片内外设功能IIC的SCL、SDL

## 模式用途

### 1、 GPIO\_Mode\_AIN ：模拟输入

一般用于ADC模拟输入

### 2、GPIO\_Mode\_IN\_FLOATING ：浮空输入

可用于按键KEY实验、发送接收信号RX、TX、IIC、USART等，不过这些实验可以不用浮空输入，如KEY用到上拉和下拉

### 3、GPIO\_Mode\_IPD：下拉输入

### 4、GPIO\_Mode\_IPU：上拉输入

IO内部上拉电阻、下拉电组输入，使情况而定，比如刚刚说的key按键实验，原理图如下：  
![在这里插入图片描述](https://img-blog.csdnimg.cn/2021070514220530.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3podWd1YW5saW4xMjE=,size_16,color_FFFFFF,t_70)  
可以看到KEY\_UP按下后，IO口应该是3V3电平输入，未按下时为悬空状态，而悬空状态IO输入是未知的，所以为了防止程序跑飞，采用下拉输入，在悬空状态下，使IO输入下拉到低电平。这样，在悬空状态下，IO检测到的是低电平，不会去执行key\_up按下后的程序。

KEY0~2按下后，IO口是低电平输入。按下时为悬空状态，而悬空状态IO输入是未知的，所以为了防止程序跑飞，采用上拉输入，在悬空状态下，使IO输入上拉到高电平。这样，在悬空状态下，IO检测到的是高电平，不会去执行KEY0 ~2按下后的程序。

### 5、GPIO\_Mode\_Out\_OD：开漏输出

IO 输出 0 接 GND，IO 输出 1，悬空，**需要外接上拉电阻，才能实现输出高电平**。当输出为 1 时，IO 口的状态由上拉电阻拉高电平，但由于是开漏输出模式，这样 IO 口也就可以 由外部电路改变为低电平或不变。该模式适用于电平不匹配场合、适合做电流型的驱动，吸收电流能力比较强。

### 6、GPIO\_Mode\_Out\_PP：推挽输出

可以输出高、低电平。导通损耗小、效率高。既提高电路的负载能力，又提高开关速度。广泛各种实验，比如接下来要总结的LED。

### 7、GPIO\_Mode\_AF\_OD：复用开漏输出

当GPIO为复用IO时的开漏输出模式，一般用于外设功能，如**TX1**

### 8、GPIO\_Mode\_AF\_PP：复用推挽输出

当GPIO为复用IO时的推挽输出模式，一般用于外设功能，如**I2C**

## 总结与分析

#### 1、什么是推挽结构和推挽电路

推挽结构一般是指**两个参数相同的三极管或MOS管分别受两互补信号的控制，总是在一个三极管或MOS管导通的时候另一个截止。高低电平由输出电平决定。**

推挽电路是两个参数相同的三极管或MOSFET，以推挽方式存在于电路中，各负责正负半周的波形放大任务。电路工作时，两只对称的功率开关管每次只有一个导通，所以导通损耗小、效率高。输出既可以向负载灌电流，也可以从负载抽取电流。推拉式输出级既提高电路的负载能力，又提高开关速度。

#### 2、开漏输出和推挽输出的区别

![在这里插入图片描述](https://img-blog.csdnimg.cn/20210707091638960.png)

+   **开漏输出：只可以输出强低电平，高电平得靠外部电阻拉高。输出端相当于三极管的集电极。适合于做电流型的驱动，其吸收电流的能力相对强(一般20ma以内)；**
+   **推挽输出:可以输出强高、低电平，连接数字器件。**

关于推挽输出和开漏输出，最后用一幅最简单的图形来概括：

![](https://img-blog.csdn.net/20180409133536882)

该图中左边的便是推挽输出模式，其中比较器输出高电平时下面的PNP三极管截止，而上面NPN三极管导通，输出电平VS+；当比较器输出低电平时则恰恰相反，PNP三极管导通，输出和地相连，为低电平。右边的则可以理解为开漏输出形式，需要接上拉。

#### 3、STM32如何选择I/O模式

+   浮空输入\_IN\_FLOATING ——浮空输入，可以做KEY识别，RX1
+   带上拉输入\_IPU——IO内部上拉电阻输入
+   带下拉输入\_IPD—— IO内部下拉电阻输入
+   模拟输入\_AIN ——应用ADC模拟输入，或者低功耗下省电
+   开漏输出\_OUT\_OD ——IO输出0接GND，IO输出1，悬空，需要外接上拉电阻，才能实现输出高电平。当输出为1时，IO口的状态由上拉电阻拉高电平，但由于是开漏输出模式，这样IO口也就可以由外部电路改变为低电平或不变。可以读IO输入电平变化，实现C51的IO双向功能
+   推挽输出\_OUT\_PP ——IO输出0-接GND， IO输出1 -接VCC，读输入值是未知的
+   复用功能的推挽输出\_AF\_PP ——片内外设功能（I2C的SCL、SDA）
+   复用功能的开漏输出\_AF\_OD——片内外设功能（TX1、MOSI、MISO.SCK.SS）